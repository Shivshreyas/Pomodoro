<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow - Focus Timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            /* Color Palette */
            --color-pomodoro: #FF6B6B;
            --color-short: #51CF66;
            --color-long: #4DABF7;
            
            /* Dark mode variants */
            --color-pomodoro-dark: #E03131;
            --color-short-dark: #2F9E44;
            --color-long-dark: #1971C2;
            
            /* Neutral colors */
            --bg-light: #FAFBFC;
            --bg-dark: #0A0E1A;
            --surface-light: #FFFFFF;
            --surface-dark: #141824;
            --text-primary-light: #1A1F36;
            --text-primary-dark: #E8ECF4;
            --text-secondary-light: #505780;
            --text-secondary-dark: #8B92B0;
            
            /* Current theme */
            --bg-current: var(--bg-light);
            --surface-current: var(--surface-light);
            --text-current: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --accent-current: var(--color-pomodoro);
            
            /* Sizing */
            --circle-size: 340px;
            --radius-lg: 32px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --radius-pill: 100px;
            
            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 12px 48px rgba(0, 0, 0, 0.12);
            --shadow-active: 0 0 0 4px rgba(255, 255, 255, 0.1);
        }

        /* Dark Mode */
        body.dark-mode {
            --bg-current: var(--bg-dark);
            --surface-current: var(--surface-dark);
            --text-current: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --color-pomodoro: var(--color-pomodoro-dark);
            --color-short: var(--color-short-dark);
            --color-long: var(--color-long-dark);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 12px 48px rgba(0, 0, 0, 0.6);
        }

        body.active-mode {
            --bg-current: var(--accent-current);
            --surface-current: rgba(255, 255, 255, 0.1);
            --text-current: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.8);
        }

        body.dark-mode.active-mode {
            --surface-current: rgba(255, 255, 255, 0.08);
        }

        /* Dark mode specific styles */
        body.dark-mode .nav-pills {
            background: rgba(255,255,255,0.08);
        }

        body.dark-mode .shortcuts-hint {
            background: rgba(255,255,255,0.08);
        }

        body.dark-mode .settings-toggle {
            background: rgba(255,255,255,0.15);
            color: var(--text-current);
        }

        body.dark-mode .settings-panel {
            background: #1a1d23;
            box-shadow: -5px 0 30px rgba(0,0,0,0.5);
        }

        body.dark-mode .setting-item {
            border-bottom-color: rgba(255,255,255,0.08);
        }

        body.dark-mode .setting-input,
        body.dark-mode .sound-selector {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.2);
        }

        body.dark-mode .toggle-switch {
            background: rgba(255,255,255,0.1);
        }

        body.dark-mode .control-btn {
            background: rgba(255,255,255,0.15);
            color: var(--text-current);
        }

        /* Active mode in dark mode - softer colors */
        body.dark-mode.active-mode .nav-pills {
            background: rgba(0,0,0,0.25);
        }

        body.dark-mode.active-mode .shortcuts-hint {
            background: rgba(0,0,0,0.25);
        }

        body.dark-mode.active-mode .control-btn {
            background: rgba(0,0,0,0.3);
            color: white;
        }

        body.dark-mode.active-mode .settings-toggle {
            background: rgba(0,0,0,0.3);
            color: white;
        }

        /* --- RESET & BASE --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-current);
            color: var(--text-current);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                        color 0.3s ease;
            overflow: visible;
            position: relative;
        }

        /* Animated gradient background */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 50%, 
                var(--accent-current) 0%, 
                transparent 50%),
                radial-gradient(circle at 80% 80%, 
                var(--accent-current) 0%, 
                transparent 50%);
            opacity: 0.08;
            transition: opacity 0.6s ease;
            z-index: 0;
            animation: gradientMove 15s ease infinite;
        }

        body.active-mode::before {
            opacity: 0.35;
        }

        @keyframes gradientMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            25% { transform: translate(8%, 8%) rotate(90deg) scale(1.1); }
            50% { transform: translate(0, 15%) rotate(180deg) scale(1.2); }
            75% { transform: translate(-8%, 8%) rotate(270deg) scale(1.1); }
        }

        /* --- MAIN CONTAINER --- */
        .container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 600px;
            padding: 32px 20px;
            overflow: visible;
        }

        /* --- HEADER --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--accent-current), var(--text-current));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Settings Toggle */
        .settings-toggle {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-pill);
            border: none;
            background: var(--surface-current);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: var(--text-current);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-toggle svg {
            width: 22px;
            height: 22px;
        }

        .settings-toggle:hover {
            transform: rotate(90deg) scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .settings-toggle:active {
            transform: rotate(90deg) scale(0.95);
        }

        /* --- MODE SELECTOR --- */
        .mode-selector {
            background: var(--surface-current);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 6px;
            border-radius: var(--radius-pill);
            display: inline-flex;
            gap: 6px;
            margin-bottom: 48px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: visible;
        }

        .mode-btn {
            position: relative;
            padding: 12px 28px;
            border: none;
            background: transparent;
            border-radius: var(--radius-pill);
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
            font-family: 'Inter', sans-serif;
        }

        .mode-btn:hover {
            color: var(--text-current);
        }

        .mode-btn.selected {
            color: #FFFFFF;
        }

        .mode-indicator {
            position: absolute;
            height: calc(100% - 12px);
            background: var(--accent-current);
            border-radius: var(--radius-pill);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 0;
            top: 6px;
        }

        /* --- TIMER CIRCLE --- */
        .timer-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 36px;
            overflow: visible;
        }

        .timer-wrapper {
            position: relative;
            width: var(--circle-size);
            height: var(--circle-size);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(var(--shadow-md));
            overflow: visible;
        }

        .timer-wrapper:hover {
            transform: scale(1.02);
        }

        .timer-wrapper:active {
            transform: scale(0.98);
        }

        /* Glass circle background */
        .timer-circle-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--surface-current);
            backdrop-filter: blur(28px);
            -webkit-backdrop-filter: blur(28px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: var(--shadow-md),
                        inset 0 0 30px rgba(255, 255, 255, 0.05);
        }

        /* SVG Progress Ring */
        .progress-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
            filter: drop-shadow(0 0 6px var(--accent-current));
            overflow: visible;
            animation: glowPulse 2.5s ease-in-out infinite;
        }

        .timer-wrapper.clicked .progress-svg {
            animation: glowBurst 0.6s ease-out forwards;
        }

        @keyframes glowPulse {
            0%, 100% { filter: drop-shadow(0 0 6px var(--accent-current)); }
            50% { filter: drop-shadow(0 0 16px var(--accent-current)); }
        }

        @keyframes glowBurst {
            0% { filter: drop-shadow(0 0 6px var(--accent-current)); }
            50% { filter: drop-shadow(0 0 24px var(--accent-current)); }
            100% { filter: drop-shadow(0 0 8px var(--accent-current)); }
        }

        .ring-track {
            fill: none;
            stroke: var(--text-secondary);
            opacity: 0.1;
            stroke-width: 2;
        }

        .ring-progress {
            fill: none;
            stroke: var(--accent-current);
            stroke-width: 6;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear,
                        stroke 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.active-mode .ring-progress {
            stroke: #FFFFFF;
        }

        /* Timer Content */
        .timer-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            user-select: none;
            width: 100%;
        }

        .timer-digits {
            font-size: 66px;
            font-weight: 500;
            font-variant-numeric: tabular-nums;
            letter-spacing: -3px;
            line-height: 1;
            margin-bottom: 12px;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .timer-status {
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .timer-progress-text {
            font-size: 11px;
            font-weight: 500;
            opacity: 0.3;
            margin-top: 8px;
            letter-spacing: 1px;
        }

        /* Play/Pause Hint */
        .timer-hint {
            margin-top: 24px;
            font-size: 32px;
            opacity: 0;
            transform: translateY(8px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        }

        .timer-wrapper:hover .timer-hint {
            opacity: 0.4;
            transform: translateY(0);
        }

        /* Pulse animation for last 10 seconds */
        @keyframes urgentPulse {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(var(--shadow-lg));
            }
            50% {
                transform: scale(1.03);
                filter: drop-shadow(var(--shadow-lg)) drop-shadow(0 0 30px var(--accent-current));
            }
        }

        .timer-wrapper.urgent {
            animation: urgentPulse 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        /* --- CONTROL BUTTONS --- */
        .controls {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .control-btn {
            padding: 14px 32px;
            border: none;
            border-radius: var(--radius-pill);
            background: var(--surface-current);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: var(--text-current);
            font-size: 14px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-sm);
            letter-spacing: 0.3px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            padding: 0;
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        #theme-toggle svg {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode #theme-toggle svg {
            transform: rotate(180deg);
        }

        /* --- KEYBOARD SHORTCUTS --- */
        .shortcuts {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .shortcuts:hover {
            opacity: 1;
        }

        .shortcut-key {
            display: inline-block;
            padding: 4px 8px;
            background: var(--surface-current);
            border-radius: 6px;
            font-weight: 600;
            font-size: 11px;
            margin: 0 3px;
            box-shadow: var(--shadow-sm);
        }

        /* --- SETTINGS PANEL --- */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }

        .settings-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -480px;
            width: 100%;
            max-width: 480px;
            height: 100vh;
            background: var(--surface-current);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            padding: 32px;
            overflow-y: auto;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 101;
            box-shadow: -8px 0 48px rgba(0, 0, 0, 0.2);
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(128, 128, 128, 0.1);
        }

        .settings-title {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .close-settings {
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(128, 128, 128, 0.1);
            border-radius: 50%;
            color: var(--text-current);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-settings:hover {
            background: rgba(128, 128, 128, 0.2);
            transform: rotate(90deg);
        }

        .settings-section {
            margin-bottom: 36px;
        }

        .settings-section h3 {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.5;
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(128, 128, 128, 0.06);
        }

        .setting-label {
            font-size: 15px;
            font-weight: 500;
        }

        .setting-input {
            width: 80px;
            padding: 10px 14px;
            border: 2px solid rgba(128, 128, 128, 0.15);
            border-radius: var(--radius-sm);
            background: rgba(128, 128, 128, 0.05);
            color: var(--text-current);
            font-size: 15px;
            font-weight: 600;
            text-align: center;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--accent-current);
            background: rgba(128, 128, 128, 0.08);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            background: rgba(128, 128, 128, 0.15);
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: var(--accent-current);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        /* Sound Selector */
        .sound-selector {
            padding: 10px 14px;
            border: 2px solid rgba(128, 128, 128, 0.15);
            border-radius: var(--radius-sm);
            background: rgba(128, 128, 128, 0.05);
            color: var(--text-current);
            font-size: 14px;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sound-selector:focus {
            outline: none;
            border-color: var(--accent-current);
        }

        /* Volume Slider */
        .volume-slider {
            width: 120px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(128, 128, 128, 0.15);
            border-radius: 2px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-current);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--accent-current);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }

        .volume-slider::-moz-range-thumb:hover {
            transform: scale(1.1);
        }

        /* --- KEYBOARD SHORTCUTS HELP --- */
        .shortcuts-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.05);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.75rem;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        body.active-mode .shortcuts-hint {
            background: rgba(255,255,255,0.15);
        }

        .shortcuts-hint:hover {
            opacity: 1;
        }

        .shortcut-key {
            display: inline-block;
            background: var(--text-current);
            color: var(--bg-current);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            margin: 0 2px;
        }

        /* --- PROGRESS PERCENTAGE --- */
        .progress-percent {
            margin-top: 8px;
            font-size: 0.75rem;
            opacity: 0.4;
            font-weight: 500;
            letter-spacing: 1px;
        }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            .settings-panel {
                width: 100%;
                right: -100%;
            }
            
            .container {
                padding: 20px 16px;
            }

            .header {
                margin-bottom: 32px;
            }

            .mode-selector {
                margin-bottom: 32px;
            }

            :root {
                --circle-size: 300px;
            }

            .timer-section {
                margin-bottom: 28px;
            }

            .controls {
                margin-bottom: 16px;
                gap: 12px;
            }

            .control-btn {
                width: 54px;
                height: 54px;
            }
        }

        @media (max-width: 480px) {
            :root {
                --circle-size: 230px;
            }
            
            .timer-digits {
                font-size: 44px;
            }
            
            .mode-btn {
                padding: 9px 16px;
                font-size: 12px;
            }
            
            .controls {
                flex-direction: column;
                width: 100%;
                margin-bottom: 12px;
            }
            
            .control-btn {
                width: 100%;
                padding: 11px 18px;
                width: 50px;
                height: 50px;
                padding: 0;
            }

            .header {
                margin-bottom: 20px;
            }

            .mode-selector {
                margin-bottom: 22px;
            }

            .timer-section {
                margin-bottom: 18px;
            }
        }

        /* Accessibility */
        *:focus-visible {
            outline: 3px solid var(--accent-current);
            outline-offset: 3px;
            border-radius: 4px;
        }

        /* Smooth scrollbar */
        .settings-panel::-webkit-scrollbar {
            width: 8px;
        }

        .settings-panel::-webkit-scrollbar-track {
            background: transparent;
        }

        .settings-panel::-webkit-scrollbar-thumb {
            background: rgba(128, 128, 128, 0.3);
            border-radius: 4px;
        }

        .settings-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(128, 128, 128, 0.5);
        }
    </style>
</head>
<body>

    <!-- Settings Overlay -->
    <div class="settings-overlay" id="settings-overlay" onclick="toggleSettings()"></div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <h2 class="settings-title">Settings</h2>
            <button class="close-settings" onclick="toggleSettings()" aria-label="Close settings">✕</button>
        </div>

        <div class="settings-section">
            <h3>Timer Durations (minutes)</h3>
            <div class="setting-item">
                <span class="setting-label">Focus Time</span>
                <input type="number" id="pomodoro-duration" class="setting-input" value="25" min="1" max="60">
            </div>
            <div class="setting-item">
                <span class="setting-label">Short Break</span>
                <input type="number" id="short-duration" class="setting-input" value="5" min="1" max="30">
            </div>
            <div class="setting-item">
                <span class="setting-label">Long Break</span>
                <input type="number" id="long-duration" class="setting-input" value="15" min="1" max="60">
            </div>
        </div>

        <div class="settings-section">
            <h3>Preferences</h3>
            <div class="setting-item">
                <span class="setting-label">Dark Mode</span>
                <div class="toggle-switch" id="dark-mode-toggle" onclick="toggleDarkMode()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            <div class="setting-item">
                <span class="setting-label">Auto-start Breaks</span>
                <div class="toggle-switch" id="auto-start-toggle" onclick="toggleAutoStart()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            <div class="setting-item">
                <span class="setting-label">Tick Sound</span>
                <div class="toggle-switch" id="tick-sound-toggle" onclick="toggleTickSound()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            <div class="setting-item">
                <span class="setting-label">Sound Volume</span>
                <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="70">
            </div>
        </div>

        <div class="settings-section">
            <h3>Alarm Sound</h3>
            <div class="setting-item">
                <select id="alarm-sound" class="sound-selector">
                    <option value="default">Default Beep</option>
                    <option value="bell">Bell</option>
                    <option value="chime">Chime</option>
                    <option value="gentle">Gentle</option>
                </select>
            </div>
        </div>

        <div class="settings-section">
            <h3>Statistics</h3>
            <div class="setting-item">
                <span class="setting-label">Sessions Today</span>
                <span class="stat-value" id="stats-today">0</span>
            </div>
            <div class="setting-item">
                <span class="setting-label">Total Sessions</span>
                <span class="stat-value" id="stats-total">0</span>
            </div>
            <div class="setting-item">
                <button class="control-btn" onclick="exportStats()" style="width: 100%;">Export Data</button>
            </div>
            <div class="setting-item">
                <button class="control-btn" onclick="resetStats()" style="width: 100%; background: #ff4757;">Reset Stats</button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">Flow</div>
            <button class="settings-toggle" onclick="toggleSettings()" aria-label="Settings">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M12 9.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M19.4 13.6c.1-.52.1-1.08 0-1.6l1.6-1.24a.5.5 0 0 0 .12-.65l-1.52-2.63a.5.5 0 0 0-.62-.2l-1.88.76a5.5 5.5 0 0 0-1.36-.8l-.28-2a.5.5 0 0 0-.5-.44h-3a.5.5 0 0 0-.5.44l-.28 2a5.5 5.5 0 0 0-1.36.8l-1.88-.76a.5.5 0 0 0-.62.2L2.88 10.1a.5.5 0 0 0 .12.65l1.6 1.24a5.5 5.5 0 0 0 0 1.6l-1.6 1.24a.5.5 0 0 0-.12.65l1.52 2.63a.5.5 0 0 0 .62.2l1.88-.76c.4.33.86.6 1.36.8l.28 2a.5.5 0 0 0 .5.44h3a.5.5 0 0 0 .5-.44l.28-2c.5-.2.96-.47 1.36-.8l1.88.76a.5.5 0 0 0 .62-.2l1.52-2.63a.5.5 0 0 0-.12-.65l-1.6-1.24Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
        </header>

        <!-- Mode Selector -->
        <div style="display: flex; justify-content: center; margin-bottom: 48px;">
            <div class="mode-selector">
                <div class="mode-indicator" id="mode-indicator"></div>
                <button class="mode-btn selected" onclick="setMode('pomodoro')" data-mode="pomodoro" aria-label="Focus mode">Focus</button>
                <button class="mode-btn" onclick="setMode('short')" data-mode="short" aria-label="Short break">Short</button>
                <button class="mode-btn" onclick="setMode('long')" data-mode="long" aria-label="Long break">Long</button>
            </div>
        </div>

        <!-- Timer Section -->
        <section class="timer-section">
            <div class="timer-wrapper" id="main-btn" role="button" tabindex="0" aria-label="Start timer">
                <div class="timer-circle-bg"></div>
                
                <svg class="progress-svg" viewBox="0 0 100 100">
                    <circle class="ring-track" cx="50" cy="50" r="46"></circle>
                    <circle class="ring-progress" cx="50" cy="50" r="46" pathLength="1" id="ring-progress"></circle>
                </svg>
                
                <div class="timer-content">
                    <div class="timer-digits" id="digits" aria-live="polite">25:00</div>
                    <div class="timer-status" id="status">TAP TO START</div>
                    <div class="timer-progress-text" id="progress-percent">0%</div>
                </div>
                
                <div class="timer-hint" id="icon-hint">▶</div>
            </div>
        </section>

        <!-- Controls -->
        <div class="controls">
            <button class="control-btn" onclick="resetTimer()" aria-label="Reset timer">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M1 4v6h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
            <button class="control-btn" onclick="toggleDarkMode()" aria-label="Toggle dark mode" id="theme-toggle">
                <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </button>
        </div>

        <!-- Keyboard Shortcuts -->
        <div class="shortcuts">
            <span class="shortcut-key">Space</span> Start/Pause
            <span class="shortcut-key">1-3</span> Switch Mode
            <span class="shortcut-key">R</span> Reset
            <span class="shortcut-key">S</span> Skip
        </div>
    </div>

    <!-- Audio Elements -->
    <!-- Click sound - cordless drill switch -->
    <audio id="sound-click" preload="auto">
        <source src="https://actions.google.com/sounds/v1/tools/18v_cordless_drill_switch.ogg" type="audio/ogg">
    </audio>
    <!-- Tick sound - from Google Sound Library -->
    <audio id="sound-tick" loop preload="auto">
        <source src="https://actions.google.com/sounds/v1/household/clock_tick_tock.ogg" type="audio/ogg">
    </audio>
    
    <!-- Alarm sounds from: https://developers.google.com/actions/tools/sound-library -->
    <audio id="alarm-default" preload="auto">
        <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
        <source src="data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU4AAAA=" type="audio/wav">
    </audio>
    <audio id="alarm-bell" preload="auto">
        <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
        <source src="data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU4AAAA=" type="audio/wav">
    </audio>
    <audio id="alarm-chime" preload="auto">
        <source src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" type="audio/ogg">
        <source src="data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU4AAAA=" type="audio/wav">
    </audio>
    <audio id="alarm-gentle" preload="auto">
        <source src="https://actions.google.com/sounds/v1/alarms/medium_bell.ogg" type="audio/ogg">
        <source src="data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU4AAAA=" type="audio/wav">
    </audio>

    <script>
        // --- ENHANCED POMODORO TIMER ---
        
        // Configuration with persistence
        const DEFAULT_CONFIG = {
            pomodoro: { time: 25 * 60, color: '#ff4757' },
            short:    { time: 5 * 60,  color: '#2ed573' },
            long:     { time: 15 * 60, color: '#1e90ff' }
        };

        let CONFIG = { ...DEFAULT_CONFIG };

        let state = {
            mode: 'pomodoro',
            timeLeft: CONFIG.pomodoro.time,
            running: false,
            startTime: null,
            interval: null,
            pomodorosCompleted: 0,
            currentTask: ''
        };

        let settings = {
            darkMode: false,
            autoStart: false,
            tickSound: false,
            volume: 0.7,
            alarmSound: 'default'
        };

        let stats = {
            totalSessions: 0,
            todaySessions: 0,
            lastDate: new Date().toDateString(),
            sessionHistory: []
        };

        // DOM Elements
        const elBody = document.body;
        const elDigits = document.getElementById('digits');
        const elStatus = document.getElementById('status');
        const elRing = document.getElementById('ring-progress');
        const elHint = document.getElementById('icon-hint');
        const elProgressPercent = document.getElementById('progress-percent');
        const elTimerWrapper = document.getElementById('main-btn');
        const elModeIndicator = document.getElementById('mode-indicator');
        const modeBtns = document.querySelectorAll('.mode-btn');

        // Audio Elements
        const soundClick = document.getElementById('sound-click');
        const soundTick = document.getElementById('sound-tick');
        
        // Init Ring
        elRing.style.strokeDasharray = 1;
        elRing.style.strokeDashoffset = 0;

        // Init mode indicator
        updateModeIndicator();

        // --- INITIALIZATION ---
        function init() {
            loadFromLocalStorage();
            updateView();
            applySettings();
            
            // Preload audio - get all audio elements properly
            const allAudio = document.querySelectorAll('audio');
            allAudio.forEach(audio => {
                if (audio && audio.load) {
                    audio.load();
                }
                // Try to enable audio immediately
                if (audio) {
                    audio.muted = true;
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            audio.pause();
                            audio.currentTime = 0;
                            audio.muted = false;
                        }).catch(() => {
                            audio.muted = false;
                        });
                    }
                }
            });

            // Set volume
            updateVolume();

            // Check if it's a new day
            checkNewDay();
        }

        // --- LOCAL STORAGE ---
        function saveToLocalStorage() {
            try {
                localStorage.setItem('pomodoroState', JSON.stringify(state));
                localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
                localStorage.setItem('pomodoroStats', JSON.stringify(stats));
                localStorage.setItem('pomodoroConfig', JSON.stringify(CONFIG));
            } catch (e) {
                console.error('Failed to save to localStorage', e);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedState = localStorage.getItem('pomodoroState');
                const savedSettings = localStorage.getItem('pomodoroSettings');
                const savedStats = localStorage.getItem('pomodoroStats');
                const savedConfig = localStorage.getItem('pomodoroConfig');

                if (savedState) {
                    const loaded = JSON.parse(savedState);
                    state.mode = loaded.mode || 'pomodoro';
                    state.pomodorosCompleted = loaded.pomodorosCompleted || 0;
                    state.currentTask = loaded.currentTask || '';
                }

                if (savedSettings) {
                    settings = { ...settings, ...JSON.parse(savedSettings) };
                }

                if (savedStats) {
                    stats = { ...stats, ...JSON.parse(savedStats) };
                }

                if (savedConfig) {
                    CONFIG = { ...DEFAULT_CONFIG, ...JSON.parse(savedConfig) };
                }

                // Reset time to mode duration (don't restore running timers)
                state.timeLeft = CONFIG[state.mode].time;
            } catch (e) {
                console.error('Failed to load from localStorage', e);
            }
        }

        function checkNewDay() {
            const today = new Date().toDateString();
            if (stats.lastDate !== today) {
                stats.todaySessions = 0;
                stats.lastDate = today;
                saveToLocalStorage();
            }
        }

        // --- VIEW UPDATES ---
        function updateView() {
            // 1. Time Formatting with precision
            const m = Math.floor(state.timeLeft / 60);
            const s = state.timeLeft % 60;
            const timeStr = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            
            elDigits.textContent = timeStr;
            
            // Update title
            const taskPrefix = state.currentTask ? `[${state.currentTask}] ` : '';
            document.title = state.running ? `${taskPrefix}(${timeStr}) Running...` : 'Unified Focus';

            // 2. Ring Progress
            const total = CONFIG[state.mode].time;
            const progress = (total - state.timeLeft) / total;
            elRing.style.strokeDashoffset = progress;

            // 3. Progress Percentage
            const percent = Math.round(progress * 100);
            elProgressPercent.textContent = `${percent}%`;

            // 4. Urgent state (last 10 seconds)
            if (state.timeLeft <= 10 && state.timeLeft > 0 && state.running) {
                elTimerWrapper.classList.add('urgent');
            } else {
                elTimerWrapper.classList.remove('urgent');
            }

            saveToLocalStorage();
        }

        // --- MODE SWITCHING ---
        function updateModeIndicator() {
            const activeBtn = document.querySelector('.mode-btn.selected');
            if (activeBtn && elModeIndicator) {
                const rect = activeBtn.getBoundingClientRect();
                const parentRect = activeBtn.parentElement.getBoundingClientRect();
                elModeIndicator.style.width = `${rect.width}px`;
                elModeIndicator.style.left = `${rect.left - parentRect.left}px`;
            }
        }

        function setMode(mode) {
            // Reset
            stopTimer();
            state.mode = mode;
            state.timeLeft = CONFIG[mode].time;
            
            // Set Accent Color
            document.documentElement.style.setProperty('--accent-current', CONFIG[mode].color);
            
            // Update Mode Buttons
            modeBtns.forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.mode === mode) {
                    btn.classList.add('selected');
                }
            });

            // Animate mode indicator
            updateModeIndicator();

            updateView();
        }

        // --- TIMER CONTROL ---
        function toggleTimer() {
            playSound(soundClick);
            
            // Trigger glow burst animation
            elTimerWrapper.classList.add('clicked');
            setTimeout(() => elTimerWrapper.classList.remove('clicked'), 600);
            
            if (state.running) {
                stopTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            if (state.timeLeft <= 0) return;

            state.running = true;
            state.startTime = Date.now() - ((CONFIG[state.mode].time - state.timeLeft) * 1000);
            
            // >>> VISUALS: TRIGGER ACTIVE MODE <<<
            elBody.classList.add('active-mode'); 
            elStatus.textContent = "TAP TO PAUSE";
            elHint.textContent = "⏸";

            // Tick sound
            if (settings.tickSound) {
                soundTick.play().catch(() => {
                    // Tick sound playback failed
                });
            }

            // Use timestamp-based calculation for accuracy
            state.interval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - state.startTime) / 1000);
                state.timeLeft = CONFIG[state.mode].time - elapsed;

                if (state.timeLeft <= 0) {
                    state.timeLeft = 0;
                    finishTimer();
                }

                updateView();
            }, 100); // Update more frequently for smooth animation

            updateView();
        }

        function stopTimer() {
            state.running = false;
            clearInterval(state.interval);
            
            // Stop tick sound
            soundTick.pause();
            soundTick.currentTime = 0;
            
            // >>> VISUALS: REMOVE ACTIVE MODE <<<
            elBody.classList.remove('active-mode');
            elStatus.textContent = state.timeLeft === CONFIG[state.mode].time ? "TAP TO START" : "TAP TO RESUME";
            elHint.textContent = "▶";
            
            updateView();
        }

        function finishTimer() {
            const completedMode = state.mode;
            stopTimer();
            elStatus.textContent = "COMPLETE!";
            
            // Play alarm
            playAlarm();

            // Update stats
            if (completedMode === 'pomodoro') {
                state.pomodorosCompleted++;
                stats.todaySessions++;
                stats.totalSessions++;
                
                // Log session
                stats.sessionHistory.push({
                    date: new Date().toISOString(),
                    task: state.currentTask,
                    mode: completedMode
                });
            }

            // Auto-start next session
            if (settings.autoStart) {
                setTimeout(() => {
                    // Suggest break after pomodoro
                    if (completedMode === 'pomodoro') {
                        const nextMode = (state.pomodorosCompleted % 4 === 0) ? 'long' : 'short';
                        setMode(nextMode);
                    } else {
                        setMode('pomodoro');
                    }
                    startTimer();
                }, 3000);
            } else {
                // Just reset
                setTimeout(() => {
                    elStatus.textContent = "TAP TO START";
                    state.timeLeft = CONFIG[state.mode].time;
                    updateView();
                }, 2000);
            }

            saveToLocalStorage();
        }

        function resetTimer() {
            playSound(soundClick);
            stopTimer();
            state.timeLeft = CONFIG[state.mode].time;
            elStatus.textContent = "TAP TO START";
            updateView();
        }

        function skipTimer() {
            playSound(soundClick);
            if (confirm('Skip to next session?')) {
                finishTimer();
            }
        }

        // --- AUDIO ---
        function playSound(audio) {
            if (audio) {
                try {
                    audio.currentTime = 0;
                    audio.volume = settings.volume;
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(() => {
                            // Browser may block audio playback
                        });
                    }
                } catch (e) {
                    // Audio playback error - continue silently
                }
            }
        }

        function playAlarm() {
            const alarmId = `alarm-${settings.alarmSound}`;
            const alarm = document.getElementById(alarmId);
            if (alarm) {
                try {
                    alarm.currentTime = 0;
                    alarm.volume = settings.volume;
                    const playPromise = alarm.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(() => {
                            // Audio playback blocked or failed
                        });
                    }
                } catch (e) {
                    // Audio playback error - continue silently
                }
            }
        }

        function updateVolume() {
            const vol = settings.volume;
            const allAudio = document.querySelectorAll('audio');
            allAudio.forEach(audio => {
                if (audio) {
                    audio.volume = vol;
                }
            });
        }

        // --- SETTINGS ---
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            const overlay = document.getElementById('settings-overlay');
            panel.classList.toggle('open');
            overlay.classList.toggle('visible');
        }

        function toggleDarkMode() {
            settings.darkMode = !settings.darkMode;
            document.getElementById('dark-mode-toggle').classList.toggle('active');
            elBody.classList.toggle('dark-mode');
            saveToLocalStorage();
        }

        function toggleAutoStart() {
            settings.autoStart = !settings.autoStart;
            document.getElementById('auto-start-toggle').classList.toggle('active');
            saveToLocalStorage();
        }

        function toggleTickSound() {
            settings.tickSound = !settings.tickSound;
            document.getElementById('tick-sound-toggle').classList.toggle('active');
            
            if (!settings.tickSound && soundTick) {
                soundTick.pause();
                soundTick.currentTime = 0;
            }
            
            saveToLocalStorage();
        }

        function applySettings() {
            if (settings.darkMode) {
                elBody.classList.add('dark-mode');
                document.getElementById('dark-mode-toggle').classList.add('active');
            }
            
            if (settings.autoStart) {
                document.getElementById('auto-start-toggle').classList.add('active');
            }
            
            if (settings.tickSound) {
                document.getElementById('tick-sound-toggle').classList.add('active');
            }

            // Set duration inputs
            document.getElementById('pomodoro-duration').value = CONFIG.pomodoro.time / 60;
            document.getElementById('short-duration').value = CONFIG.short.time / 60;
            document.getElementById('long-duration').value = CONFIG.long.time / 60;

            // Set alarm sound
            document.getElementById('alarm-sound').value = settings.alarmSound;

            // Set volume
            document.getElementById('volume-slider').value = settings.volume * 100;
        }

        // --- SETTINGS EVENT LISTENERS ---
        document.getElementById('pomodoro-duration').addEventListener('change', (e) => {
            const minutes = parseInt(e.target.value) || 25;
            CONFIG.pomodoro.time = minutes * 60;
            if (state.mode === 'pomodoro' && !state.running) {
                state.timeLeft = CONFIG.pomodoro.time;
                updateView();
            }
            saveToLocalStorage();
        });

        document.getElementById('short-duration').addEventListener('change', (e) => {
            const minutes = parseInt(e.target.value) || 5;
            CONFIG.short.time = minutes * 60;
            if (state.mode === 'short' && !state.running) {
                state.timeLeft = CONFIG.short.time;
                updateView();
            }
            saveToLocalStorage();
        });

        document.getElementById('long-duration').addEventListener('change', (e) => {
            const minutes = parseInt(e.target.value) || 15;
            CONFIG.long.time = minutes * 60;
            if (state.mode === 'long' && !state.running) {
                state.timeLeft = CONFIG.long.time;
                updateView();
            }
            saveToLocalStorage();
        });

        document.getElementById('alarm-sound').addEventListener('change', (e) => {
            settings.alarmSound = e.target.value;
            playAlarm(); // Preview
            saveToLocalStorage();
        });

        document.getElementById('volume-slider').addEventListener('input', (e) => {
            settings.volume = e.target.value / 100;
            updateVolume();
            saveToLocalStorage();
        });

        // --- STATS FUNCTIONS ---
        function exportStats() {
            const data = {
                totalSessions: stats.totalSessions,
                todaySessions: stats.todaySessions,
                pomodorosCompleted: state.pomodorosCompleted,
                sessionHistory: stats.sessionHistory,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pomodoro-stats-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetStats() {
            if (confirm('Reset all statistics? This cannot be undone.')) {
                stats = {
                    totalSessions: 0,
                    todaySessions: 0,
                    lastDate: new Date().toDateString(),
                    sessionHistory: []
                };
                state.pomodorosCompleted = 0;
                saveToLocalStorage();
            }
        }

        // --- KEYBOARD SHORTCUTS ---
        document.addEventListener('keydown', (e) => {
            // Don't trigger shortcuts when typing in input
            if (e.target.tagName === 'INPUT') return;
            
            switch(e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    toggleTimer();
                    break;
                case '1':
                    e.preventDefault();
                    setMode('pomodoro');
                    break;
                case '2':
                    e.preventDefault();
                    setMode('short');
                    break;
                case '3':
                    e.preventDefault();
                    setMode('long');
                    break;
                case 'r':
                    e.preventDefault();
                    resetTimer();
                    break;
                case 's':
                    e.preventDefault();
                    skipTimer();
                    break;
            }
        });

        // --- EVENT LISTENERS ---
        elTimerWrapper.addEventListener('click', toggleTimer);
        
        // Keyboard accessibility for timer button
        elTimerWrapper.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                toggleTimer();
            }
        });

        // Prevent page unload during active session
        window.addEventListener('beforeunload', (e) => {
            if (state.running) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });

        // Wake lock to prevent screen sleep during timer (if supported)
        let wakeLock = null;
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (err) {
                // Wake lock not supported - continue without it
            }
        }

        function releaseWakeLock() {
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
        }

        // Request wake lock when timer starts
        const originalStartTimer = startTimer;
        startTimer = function() {
            originalStartTimer();
            requestWakeLock();
        };

        const originalStopTimer = stopTimer;
        stopTimer = function() {
            originalStopTimer();
            releaseWakeLock();
        };

        // Run Initialization
        init();

        // Handle window resize for mode indicator
        window.addEventListener('resize', updateModeIndicator);

    </script>
</body>
</html>